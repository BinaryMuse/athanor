---
phase: 06-instance-and-index-pages
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/athanor_web/lib/athanor_web/router.ex
autonomous: true
gap_closure: true
requirements: [IDX-01, IDX-02]

must_haves:
  truths:
    - "Experiments pages (Index, Show, New, Edit) have padding and spacing around their content"
    - "All instance pages show a sticky top bar with the minimal Athanor nav (logo + theme toggle)"
  artifacts:
    - path: "apps/athanor_web/lib/athanor_web/router.ex"
      provides: "live_session wrapping experiment routes with Layouts.app layout"
      contains: "live_session"
  key_links:
    - from: "apps/athanor_web/lib/athanor_web/router.ex"
      to: "apps/athanor_web/lib/athanor_web/components/layouts.ex"
      via: "live_session layout: {AthanorWeb.Layouts, :app}"
      pattern: "live_session.*layout.*Layouts.*:app"
---

<objective>
Wire the `Layouts.app/1` function component as the layout for all experiment LiveView routes, fixing missing padding and non-functional sticky top bar.

Purpose: The instance LiveViews (Index, Show, New, Edit) currently only receive the `root.html.heex` wrapper (`<body>{@inner_content}</body>`) with no `Layouts.app/1` wrapping. The `Layouts.app/1` function defines the sticky header and padded main container, but Phoenix LiveView does not automatically apply it — it must be explicitly configured via `live_session` `layout:` option or per-mount `layout:` tuple. Adding a `live_session` wrapper in the router is the correct fix for all four pages at once.

Output: Router updated so experiment routes use `{AthanorWeb.Layouts, :app}` as their layout, giving all instance pages the sticky header and padded content area.
</objective>

<execution_context>
@/Users/binarymuse/.claude/get-shit-done/workflows/execute-plan.md
@/Users/binarymuse/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-instance-and-index-pages/06-01-SUMMARY.md
@.planning/phases/06-instance-and-index-pages/06-02-SUMMARY.md
@apps/athanor_web/lib/athanor_web/router.ex
@apps/athanor_web/lib/athanor_web/components/layouts.ex
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap experiment instance routes in live_session with app layout</name>
  <files>apps/athanor_web/lib/athanor_web/router.ex</files>
  <action>
In `apps/athanor_web/lib/athanor_web/router.ex`, within the `:browser` pipeline scope, wrap the four experiment instance LiveView routes in a `live_session` block that specifies the app layout.

Current route block (inside `scope "/", AthanorWeb do` / `pipe_through :browser`):

```elixir
live "/experiments", Experiments.InstanceLive.Index, :index
live "/experiments/new", Experiments.InstanceLive.New, :new
live "/experiments/:id", Experiments.InstanceLive.Show, :show
live "/experiments/:id/edit", Experiments.InstanceLive.Edit, :edit
```

Replace with:

```elixir
live_session :experiments, layout: {AthanorWeb.Layouts, :app} do
  live "/experiments", Experiments.InstanceLive.Index, :index
  live "/experiments/new", Experiments.InstanceLive.New, :new
  live "/experiments/:id", Experiments.InstanceLive.Show, :show
  live "/experiments/:id/edit", Experiments.InstanceLive.Edit, :edit
end
```

Leave the `/runs/:id` route outside the live_session (it uses `layout: {AthanorWeb.Layouts, :run}` set in its own mount).

The `live_session layout:` option tells Phoenix LiveView to wrap the rendered LiveView content with `Layouts.app/1` (the function component defined in `layouts.ex`), providing the sticky header and padded main container. This fixes both the missing padding (Gap 2) and non-functional sticky nav (Gap 3) for all four experiment pages simultaneously.
  </action>
  <verify>
Run `mix compile` (or `mix phx.routes`) from the `apps/athanor_web` directory to confirm no compilation errors.

Check that the routes are still reachable: `mix phx.routes` should list:
- GET/live `/experiments` → InstanceLive.Index
- GET/live `/experiments/new` → InstanceLive.New
- GET/live `/experiments/:id` → InstanceLive.Show
- GET/live `/experiments/:id/edit` → InstanceLive.Edit

Visually verify (or accept on code review) that `Layouts.app/1` is now applied by confirming the `live_session layout:` attribute references `AthanorWeb.Layouts, :app`.
  </verify>
  <done>
Router compiles cleanly. All four experiment instance routes are inside `live_session :experiments` with `layout: {AthanorWeb.Layouts, :app}`. The run route (`/runs/:id`) remains outside the session and is unaffected. Experiment pages now render with the sticky Athanor navbar and padded content area.
  </done>
</task>

</tasks>

<verification>
- [ ] `mix compile` passes with no errors in apps/athanor_web
- [ ] `mix phx.routes` shows all four experiment routes still defined
- [ ] `router.ex` contains `live_session :experiments, layout: {AthanorWeb.Layouts, :app}`
- [ ] `/runs/:id` route is NOT inside the live_session (it manages its own layout in mount)
</verification>

<success_criteria>
All four experiment instance pages (Index, Show, New, Edit) receive the `Layouts.app/1` wrapper which provides `sticky top-0 z-10 bg-base-100` header and `px-4 py-8 sm:px-6 lg:px-8` padded main container. The sticky nav and page padding issues are resolved at the router level, fixing both Gap 2 and Gap 3 simultaneously with a single clean change.
</success_criteria>

<output>
After completion, create `.planning/phases/06-instance-and-index-pages/06-03-SUMMARY.md`
</output>
