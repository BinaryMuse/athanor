---
phase: 01-visual-identity-and-theme-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/athanor_web/lib/athanor_web/components/layouts/root.html.heex
  - apps/athanor_web/assets/css/app.css
  - .planning/phases/01-visual-identity-and-theme-foundation/DESIGN-TOKENS.md
autonomous: false

must_haves:
  truths:
    - "All pages display with consistent typography, spacing, and color palette"
    - "User can toggle between dark and light themes via UI control"
    - "Theme persists across browser sessions"
    - "System theme preference is detected on first visit"
    - "No flash of unstyled content (FOUC) on page load"
  artifacts:
    - path: "apps/athanor_web/lib/athanor_web/components/layouts/root.html.heex"
      provides: "FOUC-free theme initialization"
      contains: "<script>" before "<link"
    - path: "apps/athanor_web/assets/css/app.css"
      provides: "Scientific aesthetic theme definitions"
      contains: "daisyui-theme"
    - path: ".planning/phases/01-visual-identity-and-theme-foundation/DESIGN-TOKENS.md"
      provides: "Design token documentation"
      min_lines: 50
  key_links:
    - from: "root.html.heex"
      to: "app.css"
      via: "data-theme attribute sets CSS variables"
      pattern: "data-theme"
    - from: "layouts.ex theme_toggle"
      to: "root.html.heex script"
      via: "phx:set-theme event dispatch"
      pattern: "phx:set-theme"
---

<objective>
Establish visual identity foundation with FOUC-free theme switching and documented design tokens.

Purpose: Phase 1 creates the visual foundation all subsequent UI work builds on. Without consistent design tokens and working theme infrastructure, every page would need individual styling decisions. By establishing typography, spacing, and color patterns now, Phases 2-6 can focus on functionality.

Output: FOUC-free theme switching, scientific aesthetic themes, documented design tokens.
</objective>

<execution_context>
@/Users/binarymuse/.claude/get-shit-done/workflows/execute-plan.md
@/Users/binarymuse/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/codebase/CONVENTIONS.md
@.planning/codebase/STACK.md
@apps/athanor_web/lib/athanor_web/components/layouts/root.html.heex
@apps/athanor_web/assets/css/app.css
@apps/athanor_web/lib/athanor_web/components/layouts.ex
@apps/athanor_web/lib/athanor_web/components/core_components.ex
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix FOUC and Document Design Tokens</name>
  <files>
    apps/athanor_web/lib/athanor_web/components/layouts/root.html.heex
    .planning/phases/01-visual-identity-and-theme-foundation/DESIGN-TOKENS.md
  </files>
  <action>
1. In root.html.heex, move the inline theme script BEFORE the CSS link tag to prevent FOUC:
   - The `<script>` block (lines 13-31) must appear BEFORE `<link phx-track-static rel="stylesheet" ...>` (line 10)
   - This ensures theme is set before CSS loads, preventing white flash in dark mode
   - Keep the defer attribute on app.js but ensure inline script blocks paint

2. Create DESIGN-TOKENS.md documenting the visual system:

   **Typography:**
   - Base font: system-ui stack (DaisyUI default)
   - Monospace: for logs, code, results (ui-monospace, SFMono-Regular, etc.)
   - Scale: text-xs (logs), text-sm (body), text-lg (headings), text-xl (page titles)
   - Leading: leading-relaxed for readability in data-dense displays

   **Spacing:**
   - Section gaps: space-y-8 between major sections
   - Card padding: p-4 standard, p-6 for main content areas
   - Inline gaps: gap-2 for tight groups, gap-4 for related items, gap-8 for sections

   **Colors (semantic, not literal):**
   - base-100/200/300: Background layers (page, card, inset)
   - base-content: Primary text
   - base-content/60: Secondary text, muted
   - base-content/40: Tertiary text, timestamps
   - primary: Interactive elements, links
   - info/success/warning/error: Status indicators (log levels, run states)
   - neutral: Borders, dividers

   **Components:**
   - Cards: bg-base-200 for cards on base-100 background
   - Insets: bg-base-300 for log panels, code blocks
   - Badges: badge-{status} for semantic status
   - Buttons: btn-primary for actions, btn-ghost for navigation

   **Patterns to AVOID:**
   - text-white, text-black (breaks theme switching)
   - Hardcoded colors like text-gray-500 (use base-content/60)
   - bg-white, bg-black (use base-100, base-content)

Document that DaisyUI semantic classes use CSS variables that automatically respond to data-theme.
  </action>
  <verify>
1. In root.html.heex, `<script>` tag appears before any `<link rel="stylesheet">` tag
2. DESIGN-TOKENS.md exists with sections for Typography, Spacing, Colors, Components, Patterns to AVOID
  </verify>
  <done>
- Theme script positioned to block paint before CSS loads
- Design token documentation exists with all required sections
  </done>
</task>

<task type="auto">
  <name>Task 2: Refine Themes for Scientific Aesthetic</name>
  <files>
    apps/athanor_web/assets/css/app.css
  </files>
  <action>
Update both theme definitions in app.css to establish a scientific/technical aesthetic:

**Light Theme (scientific lab dashboard feel):**
- base-100: Clean off-white (not pure white - easier on eyes) - oklch(98% 0.005 240)
- base-200: Subtle cool gray for cards - oklch(95% 0.008 240)
- base-300: Slightly darker for insets (log panels) - oklch(90% 0.012 240)
- base-content: Dark blue-gray for text (professional, not pure black) - oklch(25% 0.02 260)
- primary: Deep teal/blue for scientific feel (not Phoenix orange) - oklch(50% 0.15 220)
- secondary: Muted slate for secondary actions - oklch(50% 0.03 260)
- accent: Reserved for highlighting (dark for contrast) - oklch(30% 0.02 260)
- info/success/warning/error: Keep DaisyUI semantic colors but slightly desaturated for professional feel

**Dark Theme (terminal/IDE inspired):**
- base-100: Deep blue-gray (not pure black) - oklch(22% 0.02 260)
- base-200: Slightly lighter for cards - oklch(26% 0.025 258)
- base-300: Lighter still for insets - oklch(30% 0.03 256)
- base-content: Off-white (not pure white) - oklch(95% 0.01 260)
- primary: Bright teal for visibility in dark - oklch(70% 0.15 190)
- secondary: Muted blue-gray - oklch(60% 0.04 250)
- accent: Soft highlight color - oklch(75% 0.08 200)

**Both themes:**
- Keep radius values as-is (0.25rem/0.5rem for technical look)
- Keep border: 1.5px for definition
- Adjust content colors (*-content) to ensure 4.5:1 contrast ratio

Remove Phoenix-branded orange primary color from both themes. The goal is a neutral, professional aesthetic like scientific monitoring software or IDE interfaces.

Do NOT change the theme names ("light" and "dark") or the plugin structure - only the color values.
  </action>
  <verify>
1. Run `mix assets.build` - no errors
2. Both themes define blue-gray base colors (not orange primary, not pure black/white)
3. Check that both themes still have all required DaisyUI color variables
  </verify>
  <done>
- Light theme uses cool gray/teal scientific palette
- Dark theme uses deep blue-gray terminal-inspired palette
- Orange Phoenix branding removed
- Both themes maintain proper contrast ratios
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify Theme Switching and Visual Consistency</name>
  <what-built>
    FOUC-free theme switching with scientific aesthetic applied to both light and dark themes. Design tokens documented.
  </what-built>
  <how-to-verify>
    1. Start the dev server: `cd apps/athanor_web && mix phx.server`
    2. Open http://localhost:4000/experiments in browser

    **FOUC Test:**
    3. Set browser to dark mode (System Preferences or DevTools)
    4. Clear localStorage: DevTools > Application > Local Storage > delete phx:theme
    5. Hard refresh (Cmd+Shift+R) - page should load directly in dark theme, NO white flash

    **Theme Toggle Test:**
    6. Click system icon in header theme toggle - should follow system preference
    7. Click sun icon - light mode, cool gray/teal palette
    8. Click moon icon - dark mode, deep blue-gray palette
    9. Refresh page - selected theme persists

    **Visual Consistency:**
    10. Navigate to /experiments (index page) - consistent styling
    11. Click "New Experiment" - form page uses same design language
    12. If experiments exist, click one to view show page
    13. All pages should feel cohesive: same typography, spacing, card styles

    **Expected Visual:**
    - Light: Clean off-white background, blue-gray text, teal accent buttons
    - Dark: Deep blue-gray background, soft white text, bright teal accents
    - Both: Professional, data-focused aesthetic (like a lab dashboard)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Phase 1 verification criteria:
1. FOUC eliminated - dark mode users see no white flash on load
2. Theme toggle functional - all three states work (system/light/dark)
3. Theme persistence - survives page refresh
4. System preference detection - new users get their OS theme
5. Scientific aesthetic - both themes look professional and cohesive
6. Design tokens documented - future work has clear patterns to follow
</verification>

<success_criteria>
- No FOUC on page load in any theme
- Theme toggle works for system/light/dark
- Theme persists in localStorage across sessions
- Both themes have scientific/technical aesthetic (no Phoenix orange)
- DESIGN-TOKENS.md exists with typography, spacing, color, and component guidance
- All existing pages render correctly in both themes
</success_criteria>

<output>
After completion, create `.planning/phases/01-visual-identity-and-theme-foundation/01-01-SUMMARY.md`
</output>
